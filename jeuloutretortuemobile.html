<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loutre vs Upside Down</title>

<style>
  body {
    margin: 0;
    background: #0b0b14;
    font-family: Arial, sans-serif;
    color: white;
    text-align: center;
    touch-action: none; /* IMPORTANT */
  }

  h3 {
    margin-top: 10px;
  }

  .game {
    position: relative;
    width: 90vw;
    max-width: 340px;
    height: 220px;
    margin: 20px auto;
    background: radial-gradient(#111, #05050a);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 0 25px rgba(193, 18, 31, 0.6);
  }

  .player, .enemy, .goal {
    position: absolute;
    font-size: 2rem;
    pointer-events: none; /* le doigt passe √† travers */
  }

  .player { left: 10px; top: 90px; }
  .goal  { right: 10px; top: 90px; }
  .enemy { left: 150px; top: 20px; }

  .status {
    font-size: 0.9rem;
    margin-top: 8px;
  }
</style>
</head>

<body>

<h3>ü¶¶ Retrouve la üê¢</h3>

<div class="game" id="game">
  <div class="player" id="player">ü¶¶</div>
  <div class="enemy" id="enemy">üëæ</div>
  <div class="goal" id="goal">üê¢</div>
</div>

<div class="status" id="status">
  Glisse ton doigt pour bouger la loutre
</div>

<script>
  const game = document.getElementById("game");
  const player = document.getElementById("player");
  const enemy = document.getElementById("enemy");
  const goal = document.getElementById("goal");
  const status = document.getElementById("status");

  let playing = true;

  let px = 10, py = 90;
  let ex = 150, ey = 20;

  let targetX = px, targetY = py;

  const enemySpeed = 1.3; // √©quilibre mobile

  function clamp(v, min, max) {
    return Math.max(min, Math.min(v, max));
  }

  function updatePositions() {
    player.style.left = px + "px";
    player.style.top = py + "px";
    enemy.style.left = ex + "px";
    enemy.style.top = ey + "px";
  }

  // üéØ Contr√¥le tactile fluide
  game.addEventListener("touchmove", e => {
    if (!playing) return;

    const rect = game.getBoundingClientRect();
    const touch = e.touches[0];

    targetX = touch.clientX - rect.left - 15;
    targetY = touch.clientY - rect.top - 15;

    targetX = clamp(targetX, 0, game.clientWidth - 30);
    targetY = clamp(targetY, 0, game.clientHeight - 30);
  });

  // ü¶¶ interpolation (fluide)
  function movePlayerSmooth() {
    px += (targetX - px) * 0.25;
    py += (targetY - py) * 0.25;
  }

  // üëæ poursuite intelligente
  function moveEnemy() {
    const dx = px - ex;
    const dy = py - ey;
    const dist = Math.hypot(dx, dy) || 1;

    ex += (dx / dist) * enemySpeed;
    ey += (dy / dist) * enemySpeed;

    ex = clamp(ex, 0, game.clientWidth - 30);
    ey = clamp(ey, 0, game.clientHeight - 30);
  }

  function isTouching(ax, ay, bx, by) {
    return Math.abs(ax - bx) < 22 && Math.abs(ay - by) < 22;
  }

  function checkCollision() {
    if (isTouching(px, py, ex, ey)) {
      playing = false;
      status.textContent = "üíÄ Le Demogorgon t‚Äôa attrap√©e‚Ä¶";
    }

    if (isTouching(px, py, goal.offsetLeft, goal.offsetTop)) {
      playing = false;
      status.textContent =
        "‚ù§Ô∏è M√™me dans l‚ÄôUpside Down, l‚Äôamour trouve toujours son chemin.";
    }
  }

  // üïπÔ∏è boucle de jeu fluide (requestAnimationFrame)
  function gameLoop() {
    if (!playing) return;

    movePlayerSmooth();
    moveEnemy();
    checkCollision();
    updatePositions();

    requestAnimationFrame(gameLoop);
  }

  updatePositions();
  gameLoop();

  // üéÆ clavier PC toujours dispo
  document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") targetY -= 15;
    if (e.key === "ArrowDown") targetY += 15;
    if (e.key === "ArrowLeft") targetX -= 15;
    if (e.key === "ArrowRight") targetX += 15;
  });
</script>

</body>
</html>
